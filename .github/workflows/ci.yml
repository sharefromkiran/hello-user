name: Spring Boot CI/CD
# Name of the GitHub Actions workflow (visible in Actions tab)

on:
  push:
    branches:
      - main
# Trigger: this workflow runs whenever code is pushed to main branch

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    # GitHub-hosted Linux runner (NOT WSL, NOT local machine)

    steps:
      # Step 1: Checkout source code from GitHub repo
      - uses: actions/checkout@v4

      # Step 2: Setup Java 17 environment
      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      # Step 3: Build Spring Boot JAR using Maven
      # -B = batch mode (recommended for CI)
      - name: Build JAR
        run: mvn -B clean package

      # Step 4: Login to Docker Hub securely
      # Username & password are read from GitHub Secrets (SAFE)
      - name: Login to Docker Hub
        run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login \
             -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin

      # Step 5: Build Docker image
      # Image name format: dockerhub-username/repo-name:tag
      - name: Build Docker Image
        run: docker build -t sharefromkiran/hello-user:latest .

      # Step 6: Push Docker image to Docker Hub
      - name: Push Docker Image
        run: docker push sharefromkiran/hello-user:latest
